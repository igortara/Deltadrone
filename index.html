<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deltadrone</title>
    <meta name="description" content="Deltadrone - –ì—Ä–∞ –ø—Ä–æ –≤—ñ–π—Å—å–∫–æ–≤—É –ø—Ä–æ–≥—Ä–∞–º—É Delta">
    <meta name="keywords" content="Deltadrone, –≥—Ä–∞, –≤—ñ–π—Å—å–∫–æ–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–∞, Delta">
    <link rel="stylesheet" href="leaflet.css">
    <link rel="stylesheet" href="css/style.css">

    <style>
        html, body {
            height: 100%; 
            margin: 0;   
            padding: 0;  
            overflow: hidden; 
        }

        
        #mapid {
            height: 100%;
            width: 100%;
        }
        .drone-icon {
            transform-origin: center center !important; 
        }
    </style>
</head>
<body>
    <div id="mapid"></div>

    <script src="js/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
    <script src="js/game.js"></script>

<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É Shahed</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body, html { margin: 0; height: 100%; }
    #mapid { height: 100%; width: 100%; }
    .drone-icon img {
      transition: transform 0.2s linear;
    }
  </style>
</head>
<body>

<div id="mapid"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–∞–ø–∏
  const mymap = L.map('mapid').setView([49, 32], 6);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18
  }).addTo(mymap);

  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –∑–∞–ø—É—Å–∫—É
  const kursk = [51.7306, 36.1939];
  const orel = [52.8915, 35.8594];

  const ukraineBounds = {
    minLat: 44.38,
    maxLat: 52.38,
    minLng: 22.14,
    maxLng: 40.23
  };

  // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤–∏–ø–∞–¥–∫–æ–≤–æ—ó —Ü—ñ–ª—ñ –≤ –£–∫—Ä–∞—ó–Ω—ñ
  function getRandomUkrainePoint() {
    const lat = ukraineBounds.minLat + Math.random() * (ukraineBounds.maxLat - ukraineBounds.minLat);
    const lng = ukraineBounds.minLng + Math.random() * (ukraineBounds.maxLng - ukraineBounds.minLng);
    return [lat, lng];
  }

  // –ê–Ω—ñ–º–∞—Ü—ñ—è —Ä—É—Ö—É –¥—Ä–æ–Ω–∞
  function flyDrone(from, to) {
    const droneIcon = L.divIcon({
      className: "drone-icon",
      html: `<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fc/Drone_icon.svg/32px-Drone_icon.svg.png" width="32" height="32" />`,
      iconSize: [32, 32],
      iconAnchor: [16, 16]
    });

    const marker = L.marker(from, { icon: droneIcon }).addTo(mymap);
    const targetMarker = L.circleMarker(to, {
      radius: 6,
      color: 'red'
    }).addTo(mymap).bindPopup("üéØ –¶—ñ–ª—å");

    const speed = 0.002; // —à–≤–∏–¥–∫—ñ—Å—Ç—å

    function move() {
      const lat = marker.getLatLng().lat;
      const lng = marker.getLatLng().lng;

      const dLat = to[0] - lat;
      const dLng = to[1] - lng;
      const dist = Math.sqrt(dLat * dLat + dLng * dLng);

      if (dist < 0.01) {
        marker.setLatLng(to);
        marker.bindPopup("üí• –í–∏–±—É—Ö!").openPopup();

        setTimeout(() => {
          mymap.removeLayer(marker);
          mymap.removeLayer(targetMarker);
        }, 2000);
        return;
      }

      const normLat = dLat / dist;
      const normLng = dLng / dist;

      marker.setLatLng([lat + normLat * speed, lng + normLng * speed]);

      // –†–æ–∑–≤–æ—Ä–æ—Ç
      const angleRad = Math.atan2(dLng, dLat);
      const angleDeg = angleRad * (180 / Math.PI);
      const img = marker.getElement()?.querySelector('img');
      if (img) img.style.transform = `rotate(${angleDeg}deg)`;

      requestAnimationFrame(move);
    }

    move();
  }

  // –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –¥—Ä–æ–Ω–∞
  function spawnShahed() {
    const target = getRandomUkrainePoint();
    const origin = Math.random() < 0.5 ? kursk : orel;
    flyDrone(origin, target);
  }

  // –°—Ç–∞—Ä—Ç
  spawnShahed();
  setInterval(spawnShahed, 10000); // –∫–æ–∂–Ω—ñ 10 —Å–µ–∫
</script>

</body>
</html>
